<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WordApp</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; }
    h1 { margin-bottom: 14px; }
    input, button, textarea { width: 100%; padding: 14px; font-size: 16px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
    button { background: #efefef; border: 1px solid #e1e1e1; }
    button:active { transform: scale(0.99); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .card { border: 1px solid #eee; border-radius: 14px; padding: 18px; margin-top: 10px; }
    .big { font-size: 22px; font-weight: 700; text-align: center; margin: 10px 0 6px; }
    .muted { color: #666; font-size: 13px; }
    .ok { color: #0a7f2e; font-weight: 600; }
    .bad { color: #b00020; font-weight: 600; }
    .divider { height: 1px; background: #eee; margin: 14px 0; }
    textarea { min-height: 120px; }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; background:#f3f3f3; font-size: 12px; margin-right: 6px; }
  </style>
</head>
<body>
  <h1>WordApp</h1>

  <input id="en" placeholder="English" />
  <input id="tr" placeholder="TÃ¼rkÃ§e" />

  <div class="row">
    <button id="btnAdd">Kelime Ekle</button>
    <button id="btnStudy">Kelime Ã‡alÄ±ÅŸ (Rastgele)</button>
  </div>
  <div class="row">
    <button id="btnShow">CevabÄ± GÃ¶ster</button>
    <button id="btnDel">Bu Kelimeyi Sil</button>
  </div>

  <div class="card">
    <div class="big" id="question">HenÃ¼z soru yok</div>
    <div class="muted" id="answerLine"></div>

    <div class="divider"></div>

    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
      <span class="pill" id="countPill">Toplam kelime: 0</span>
      <span class="pill" id="modePill">Mod: Normal</span>
      <span class="pill" id="scorePill">Skor: 0 / 0</span>
    </div>

    <div class="muted" id="status">âœ… HazÄ±r. Kelime ekleyebilirsin.</div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px;">Quiz Modu (A): Ä°ngilizce â†’ TÃ¼rkÃ§e yaz</h3>
    <div class="row">
      <button id="btnQuizStart">Quiz BaÅŸlat</button>
      <button id="btnQuizExit">Quiz Kapat</button>
    </div>

    <input id="quizInput" placeholder="TÃ¼rkÃ§e cevabÄ± buraya yaz..." disabled />
    <div class="row">
      <button id="btnQuizCheck" disabled>Kontrol Et</button>
      <button id="btnQuizNext" disabled>Sonraki Soru</button>
    </div>
    <button id="btnQuizReveal" disabled>DoÄŸru CevabÄ± GÃ¶ster</button>
    <div class="muted" id="quizFeedback"></div>
  </div>

  <div class="card">
    <div class="row">
      <button id="btnBackup">Yedek Al (JSON)</button>
      <button id="btnCopy">JSON Kopyala</button>
    </div>
    <button id="btnImport">JSON Ä°Ã§e Aktar</button>
    <textarea id="jsonBox" placeholder="Yedek JSON burada gÃ¶rÃ¼necek / buraya yapÄ±ÅŸtÄ±rÄ±p Ä°Ã§e Aktar'a basabilirsin"></textarea>

    <div class="muted" style="margin-top:8px;">
      â€¢ Kelimeler cihazÄ±nda kalÄ±cÄ± kaydedilir (localStorage).<br/>
      â€¢ Yedek almak iÃ§in â€œYedek Al (JSON)â€ â†’ JSONâ€™u kopyalayÄ±p Notlarâ€™a/Driveâ€™a kaydedebilirsin.<br/>
      â€¢ Geri yÃ¼klemek iÃ§in JSONâ€™u buraya yapÄ±ÅŸtÄ±r â†’ â€œJSON Ä°Ã§e Aktarâ€.
    </div>
  </div>

<script>
  // ====== Storage ======
  const STORAGE_KEY = "wordapp_words_v2";

  function loadWords() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      // normalize
      return arr
        .filter(x => x && typeof x.en === "string" && typeof x.tr === "string")
        .map(x => ({ en: x.en.trim(), tr: x.tr.trim() }))
        .filter(x => x.en && x.tr);
    } catch {
      return [];
    }
  }

  function saveWords(words) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
  }

  let words = loadWords();

  // ====== UI refs ======
  const enEl = document.getElementById("en");
  const trEl = document.getElementById("tr");

  const questionEl = document.getElementById("question");
  const answerLineEl = document.getElementById("answerLine");
  const statusEl = document.getElementById("status");
  const countPill = document.getElementById("countPill");
  const modePill = document.getElementById("modePill");
  const scorePill = document.getElementById("scorePill");

  // buttons
  const btnAdd = document.getElementById("btnAdd");
  const btnStudy = document.getElementById("btnStudy");
  const btnShow = document.getElementById("btnShow");
  const btnDel = document.getElementById("btnDel");

  // backup/import
  const btnBackup = document.getElementById("btnBackup");
  const btnCopy = document.getElementById("btnCopy");
  const btnImport = document.getElementById("btnImport");
  const jsonBox = document.getElementById("jsonBox");

  // quiz
  const btnQuizStart = document.getElementById("btnQuizStart");
  const btnQuizExit = document.getElementById("btnQuizExit");
  const quizInput = document.getElementById("quizInput");
  const btnQuizCheck = document.getElementById("btnQuizCheck");
  const btnQuizNext = document.getElementById("btnQuizNext");
  const btnQuizReveal = document.getElementById("btnQuizReveal");
  const quizFeedback = document.getElementById("quizFeedback");

  // ====== State ======
  let current = null;          // {en,tr} selected
  let quizMode = false;
  let quizCurrent = null;      // current quiz word
  let quizTotal = 0;
  let quizCorrect = 0;

  function setStatus(msg, kind="ok") {
    statusEl.innerHTML = msg;
    statusEl.className = kind === "bad" ? "bad" : "ok";
  }

  function updateInfo() {
    countPill.textContent = "Toplam kelime: " + words.length;
    modePill.textContent = "Mod: " + (quizMode ? "Quiz" : "Normal");
    scorePill.textContent = "Skor: " + quizCorrect + " / " + quizTotal;
  }

  function pickRandomWord() {
    if (words.length === 0) return null;
    const idx = Math.floor(Math.random() * words.length);
    return words[idx];
  }

  // ====== Normal functions ======
  function addWord() {
    const en = enEl.value.trim();
    const tr = trEl.value.trim();
    if (!en || !tr) {
      setStatus("âŒ Ä°ngilizce ve TÃ¼rkÃ§e alanlarÄ±nÄ± doldur.", "bad");
      return;
    }

    // prevent exact duplicate
    const exists = words.some(w => w.en.toLowerCase() === en.toLowerCase() && w.tr.toLowerCase() === tr.toLowerCase());
    if (exists) {
      setStatus("âš ï¸ Bu kelime zaten var.", "bad");
      return;
    }

    words.push({ en, tr });
    saveWords(words);

    enEl.value = "";
    trEl.value = "";
    setStatus("âœ… Kelime eklendi.");
    updateInfo();
  }

  function studyRandom() {
    if (words.length === 0) {
      setStatus("âŒ HenÃ¼z kelime yok. Ã–nce kelime ekle.", "bad");
      return;
    }
    current = pickRandomWord();
    questionEl.textContent = current.en;
    answerLineEl.textContent = ""; // hidden
    setStatus("âœ… Rastgele kelime seÃ§ildi.");
    updateInfo();
  }

  function showAnswer() {
    if (!current) {
      setStatus("âŒ Ã–nce 'Kelime Ã‡alÄ±ÅŸ (Rastgele)' ile bir kelime seÃ§.", "bad");
      return;
    }
    answerLineEl.textContent = "Cevap: " + current.tr;
    setStatus("âœ… Cevap gÃ¶sterildi.");
  }

  function deleteCurrent() {
    if (!current) {
      setStatus("âŒ Silmek iÃ§in Ã¶nce bir kelime seÃ§.", "bad");
      return;
    }
    const before = words.length;
    words = words.filter(w => !(w.en === current.en && w.tr === current.tr));
    saveWords(words);
    const after = words.length;

    current = null;
    questionEl.textContent = "HenÃ¼z soru yok";
    answerLineEl.textContent = "";
    setStatus(`ğŸ—‘ï¸ Silindi. (${before - after} adet)`);
    updateInfo();
  }

  // ====== Backup / Import ======
  function backupJSON() {
    const data = JSON.stringify(words, null, 2);
    jsonBox.value = data;
    setStatus("âœ… Yedek hazÄ±r. Ä°stersen JSONâ€™u kopyalayÄ±p saklayabilirsin.");
  }

  async function copyJSON() {
    const text = jsonBox.value.trim();
    if (!text) {
      setStatus("âŒ Ã–nce 'Yedek Al (JSON)' de, sonra kopyala.", "bad");
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      setStatus("âœ… JSON kopyalandÄ±.");
    } catch {
      // fallback
      jsonBox.focus();
      jsonBox.select();
      setStatus("âš ï¸ Otomatik kopyalama olmadÄ±. Metni seÃ§ip manuel kopyalayabilirsin.", "bad");
    }
  }

  function importJSON() {
    const text = jsonBox.value.trim();
    if (!text) {
      setStatus("âŒ JSON kutusu boÅŸ.", "bad");
      return;
    }
    try {
      const arr = JSON.parse(text);
      if (!Array.isArray(arr)) throw new Error("not array");

      const cleaned = arr
        .filter(x => x && typeof x.en === "string" && typeof x.tr === "string")
        .map(x => ({ en: x.en.trim(), tr: x.tr.trim() }))
        .filter(x => x.en && x.tr);

      words = cleaned;
      saveWords(words);
      setStatus("âœ… Ä°Ã§e aktarÄ±ldÄ±. Toplam: " + words.length);
      updateInfo();
    } catch {
      setStatus("âŒ GeÃ§ersiz JSON. LÃ¼tfen doÄŸru format yapÄ±ÅŸtÄ±r.", "bad");
    }
  }

  // ====== QUIZ (A) ======
  function setQuizControls(enabled) {
    quizInput.disabled = !enabled;
    btnQuizCheck.disabled = !enabled;
    btnQuizNext.disabled = !enabled;
    btnQuizReveal.disabled = !enabled;
  }

  function quizStart() {
    if (words.length === 0) {
      setStatus("âŒ Quiz iÃ§in Ã¶nce kelime eklemelisin.", "bad");
      return;
    }
    quizMode = true;
    quizTotal = 0;
    quizCorrect = 0;
    quizFeedback.textContent = "Quiz baÅŸladÄ±. Ä°ngilizce kelimeyi gÃ¶r, TÃ¼rkÃ§esini yaz.";
    setQuizControls(true);
    quizNext(); // first question
    updateInfo();
    setStatus("âœ… Quiz modu aÃ§Ä±k.");
  }

  function quizExit() {
    quizMode = false;
    quizCurrent = null;
    quizInput.value = "";
    quizFeedback.textContent = "";
    setQuizControls(false);
    questionEl.textContent = "HenÃ¼z soru yok";
    answerLineEl.textContent = "";
    updateInfo();
    setStatus("âœ… Quiz kapatÄ±ldÄ±.");
  }

  function quizNext() {
    if (!quizMode) return;
    quizCurrent = pickRandomWord();
    questionEl.textContent = quizCurrent.en;   // A: show English
    answerLineEl.textContent = "";             // hide
    quizInput.value = "";
    quizInput.focus();
    quizFeedback.textContent = "TÃ¼rkÃ§esini yazÄ±p 'Kontrol Et' bas.";
    updateInfo();
  }

  function normalizeTR(s) {
    return (s || "")
      .trim()
      .toLowerCase()
      .replace(/\s+/g, " ");
  }

  function quizCheck() {
    if (!quizMode || !quizCurrent) return;

    const userAns = normalizeTR(quizInput.value);
    const correctAns = normalizeTR(quizCurrent.tr);

    if (!userAns) {
      quizFeedback.innerHTML = `<span class="bad">âŒ BoÅŸ bÄ±rakma.</span>`;
      return;
    }

    quizTotal += 1;

    if (userAns === correctAns) {
      quizCorrect += 1;
      quizFeedback.innerHTML = `<span class="ok">âœ… DoÄŸru!</span>`;
      setStatus("âœ… DoÄŸru cevap.");
    } else {
      quizFeedback.innerHTML = `<span class="bad">âŒ YanlÄ±ÅŸ.</span> DoÄŸru: <b>${quizCurrent.tr}</b>`;
      setStatus("âŒ YanlÄ±ÅŸ cevap.", "bad");
    }

    updateInfo();
  }

  function quizReveal() {
    if (!quizMode || !quizCurrent) return;
    quizFeedback.innerHTML = `DoÄŸru: <b>${quizCurrent.tr}</b>`;
    setStatus("â„¹ï¸ DoÄŸru cevap gÃ¶sterildi.");
  }

  // ====== Events ======
  btnAdd.addEventListener("click", addWord);
  btnStudy.addEventListener("click", studyRandom);
  btnShow.addEventListener("click", showAnswer);
  btnDel.addEventListener("click", deleteCurrent);

  btnBackup.addEventListener("click", backupJSON);
  btnCopy.addEventListener("click", copyJSON);
  btnImport.addEventListener("click", importJSON);

  btnQuizStart.addEventListener("click", quizStart);
  btnQuizExit.addEventListener("click", quizExit);
  btnQuizNext.addEventListener("click", quizNext);
  btnQuizCheck.addEventListener("click", quizCheck);
  btnQuizReveal.addEventListener("click", quizReveal);

  // Enter ile kontrol et
  quizInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !btnQuizCheck.disabled) {
      quizCheck();
    }
  });

  // init
  updateInfo();
</script>
</body>
</html>
