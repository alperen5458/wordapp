<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WordApp</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; padding: 20px; max-width: 700px; margin: 0 auto; }
    h1 { margin: 8px 0 16px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    input, button, textarea, select { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { cursor: pointer; }
    #card { margin-top: 16px; padding: 18px; border: 1px solid #ddd; border-radius: 12px; font-size: 22px; font-weight: 700; min-height: 72px; display:flex; align-items:center; justify-content:center; }
    #info { margin-top: 10px; color: #444; font-size: 14px; white-space: pre-line; }
    .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    .btns3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
    .muted { color:#666; font-size: 13px; margin-top: 6px; }
    textarea { height: 140px; }
    hr { margin: 18px 0; border: none; border-top: 1px solid #eee; }
  </style>
</head>
<body>
  <h1>WordApp</h1>

  <div class="row">
    <input id="en" placeholder="English" autocomplete="off" />
    <input id="tr" placeholder="TÃ¼rkÃ§e" autocomplete="off" />

    <div class="btns">
      <button id="addBtn">Kelime Ekle</button>
      <button id="randomBtn">Kelime Ã‡alÄ±ÅŸ (Rastgele)</button>
    </div>

    <div class="btns">
      <button id="showBtn">CevabÄ± GÃ¶ster</button>
      <button id="deleteBtn">Bu Kelimeyi Sil</button>
    </div>

    <div id="card">HenÃ¼z soru yok</div>
    <div id="info"></div>

    <hr />

    <div class="btns3">
      <button id="exportBtn">Yedek Al (JSON)</button>
      <button id="copyBtn">JSON Kopyala</button>
      <button id="importBtn">JSON Ä°Ã§e Aktar</button>
    </div>

    <textarea id="jsonBox" placeholder="Yedek JSON burada gÃ¶rÃ¼necek / buraya yapÄ±ÅŸtÄ±rÄ±p Ä°Ã§e Aktar'a basabilirsin"></textarea>
    <div class="muted">
      â€¢ Kelimeler cihazÄ±nda kalÄ±cÄ± kaydedilir (localStorage).<br/>
      â€¢ Yedek almak iÃ§in â€œYedek Al (JSON)â€ â†’ JSONâ€™u kopyalayÄ±p Notlarâ€™a/Driveâ€™a kaydedebilirsin.<br/>
      â€¢ Geri yÃ¼klemek iÃ§in JSONâ€™u buraya yapÄ±ÅŸtÄ±r â†’ â€œJSON Ä°Ã§e Aktarâ€.
    </div>
  </div>

<script>
(() => {
  const STORAGE_KEY = "wordapp_words_v1";

  /** @type {{en:string,tr:string,createdAt:number}[]} */
  let words = [];
  /** @type {{en:string,tr:string,dir:"en"|"tr"}|null} */
  let current = null;

  const $ = (id) => document.getElementById(id);

  const enEl = $("en");
  const trEl = $("tr");
  const cardEl = $("card");
  const infoEl = $("info");
  const jsonBox = $("jsonBox");

  function norm(s) {
    return (s || "").trim();
  }

  function load() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) { words = []; return; }
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) {
        // Eski format destek: [{en,tr}] veya yeni format
        words = parsed
          .map(x => ({
            en: norm(x.en),
            tr: norm(x.tr),
            createdAt: typeof x.createdAt === "number" ? x.createdAt : Date.now()
          }))
          .filter(x => x.en && x.tr);
      } else {
        words = [];
      }
    } catch (e) {
      words = [];
    }
  }

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
  }

  function updateInfo(msg) {
    const count = words.length;
    const currentTxt = current ? `\nÅu an: ${current.en} â€” ${current.tr}` : "";
    infoEl.textContent = `Toplam kelime: ${count}${msg ? "\n" + msg : ""}${currentTxt}`;
  }

  function addWord() {
    const en = norm(enEl.value);
    const tr = norm(trEl.value);

    if (!en || !tr) {
      updateInfo("âš ï¸ Ä°ngilizce ve TÃ¼rkÃ§e alanlarÄ±nÄ± doldur.");
      return;
    }

    // AynÄ± Ä°ngilizce kelime varsa gÃ¼ncelle
    const idx = words.findIndex(w => w.en.toLowerCase() === en.toLowerCase());
    if (idx >= 0) {
      words[idx].tr = tr;
      words[idx].createdAt = Date.now();
      save();
      updateInfo("âœ… Var olan kelime gÃ¼ncellendi.");
    } else {
      words.push({ en, tr, createdAt: Date.now() });
      save();
      updateInfo("âœ… Kelime eklendi.");
    }

    enEl.value = "";
    trEl.value = "";
    enEl.focus();
  }

  function randomWord() {
    if (words.length === 0) {
      current = null;
      cardEl.textContent = "Ã–nce kelime ekle";
      updateInfo("âš ï¸ Listede kelime yok.");
      return;
    }
    const pick = words[Math.floor(Math.random() * words.length)];
    const dir = Math.random() > 0.5 ? "en" : "tr";
    current = { en: pick.en, tr: pick.tr, dir };
    cardEl.textContent = dir === "en" ? pick.en : pick.tr;
    updateInfo("ğŸ¯ Rastgele soru seÃ§ildi.");
  }

  function showAnswer() {
    if (!current) {
      updateInfo("âš ï¸ Ã–nce â€˜Kelime Ã‡alÄ±ÅŸ (Rastgele)â€™ bas.");
      return;
    }
    cardEl.textContent = current.dir === "en" ? current.tr : current.en;
    updateInfo("ğŸ‘€ Cevap gÃ¶sterildi.");
  }

  function deleteCurrent() {
    if (!current) {
      updateInfo("âš ï¸ Silmek iÃ§in Ã¶nce bir kelime seÃ§.");
      return;
    }
    const before = words.length;
    words = words.filter(w => !(w.en === current.en && w.tr === current.tr));
    if (words.length !== before) {
      save();
      updateInfo("ğŸ—‘ï¸ SeÃ§ili kelime silindi.");
    } else {
      updateInfo("âš ï¸ Silinecek kelime bulunamadÄ±.");
    }
    current = null;
    cardEl.textContent = "HenÃ¼z soru yok";
  }

  function exportJson() {
    // Sadece en,tr export edelim (temiz format)
    const out = words.map(w => ({ en: w.en, tr: w.tr }));
    const txt = JSON.stringify(out, null, 2);
    jsonBox.value = txt;

    // Dosya indir (Safariâ€™de â€œDosyalarâ€™a Kaydetâ€ aÃ§Ä±lÄ±r)
    const blob = new Blob([txt], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "words.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);

    updateInfo("âœ… JSON yedek hazÄ±r. Ä°ndirilenlere/Dosyalara kaydedebilirsin.");
  }

  async function copyJson() {
    const txt = jsonBox.value.trim();
    if (!txt) { updateInfo("âš ï¸ Kopyalanacak JSON yok. Ã–nce â€˜Yedek Al (JSON)â€™ bas."); return; }
    try {
      await navigator.clipboard.writeText(txt);
      updateInfo("âœ… JSON kopyalandÄ±.");
    } catch {
      // iOS bazen izin vermez; fallback
      jsonBox.focus();
      jsonBox.select();
      updateInfo("â„¹ï¸ Kopyalama iÃ§in metni seÃ§tim. â€˜Kopyalaâ€™ de.");
    }
  }

  function importJson() {
    const txt = jsonBox.value.trim();
    if (!txt) { updateInfo("âš ï¸ Ä°Ã§e aktarÄ±lacak JSON yok."); return; }

    try {
      const parsed = JSON.parse(txt);
      if (!Array.isArray(parsed)) throw new Error("JSON dizi deÄŸil");

      const cleaned = parsed
        .map(x => ({ en: norm(x.en), tr: norm(x.tr), createdAt: Date.now() }))
        .filter(x => x.en && x.tr);

      if (cleaned.length === 0) {
        updateInfo("âš ï¸ JSON iÃ§inde geÃ§erli kelime bulunamadÄ±.");
        return;
      }

      // Var olanlarla birleÅŸtir (en bazlÄ±)
      const map = new Map(words.map(w => [w.en.toLowerCase(), w]));
      for (const w of cleaned) {
        map.set(w.en.toLowerCase(), w);
      }
      words = Array.from(map.values());
      save();
      updateInfo(`âœ… Ä°Ã§e aktarÄ±ldÄ±: ${cleaned.length} kayÄ±t iÅŸlendi. Toplam: ${words.length}`);
    } catch (e) {
      updateInfo("âŒ JSON okunamadÄ±. Format hatalÄ± olabilir.");
    }
  }

  // Event baÄŸla
  $("addBtn").addEventListener("click", addWord);
  $("randomBtn").addEventListener("click", randomWord);
  $("showBtn").addEventListener("click", showAnswer);
  $("deleteBtn").addEventListener("click", deleteCurrent);
  $("exportBtn").addEventListener("click", exportJson);
  $("copyBtn").addEventListener("click", copyJson);
  $("importBtn").addEventListener("click", importJson);

  // Enter ile ekleme kolaylÄ±ÄŸÄ±
  trEl.addEventListener("keydown", (e) => { if (e.key === "Enter") addWord(); });
  enEl.addEventListener("keydown", (e) => { if (e.key === "Enter") trEl.focus(); });

  // BaÅŸlat
  load();
  updateInfo("âœ… HazÄ±r. Kelime ekleyebilirsin.");
})();
</script>
</body>
</html>
