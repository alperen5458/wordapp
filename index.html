<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WordApp</title>
  <style>
    :root { --w: 900px; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; padding: 22px; background:#fff; color:#111; }
    h1 { margin: 0 0 16px; font-size: 44px; font-weight: 800; }
    .wrap { max-width: var(--w); margin: 0 auto; }
    input, textarea, button {
      width: 100%;
      box-sizing: border-box;
      font-size: 18px;
      padding: 14px 16px;
      border: 1px solid #e5e5e5;
      border-radius: 10px;
      outline: none;
      background: #fff;
    }
    textarea { min-height: 110px; resize: vertical; }
    input:focus, textarea:focus { border-color:#cfcfcf; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 14px; }
    .btn { background:#efefef; border:1px solid #e1e1e1; font-weight: 700; cursor:pointer; }
    .btn:active { transform: scale(0.99); }
    .btn.primary { background:#e9e9e9; }
    .btn.danger { background:#efefef; }
    .card {
      margin-top: 16px;
      border: 1px solid #e9e9e9;
      border-radius: 12px;
      padding: 18px;
      min-height: 90px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-size: 30px;
      font-weight: 800;
      background:#fff;
    }
    .meta { margin-top: 10px; font-size: 16px; color:#333; }
    .ok { color:#0a7a2a; font-weight:700; }
    .bad { color:#b00020; font-weight:700; }
    hr { border:none; border-top:1px solid #eee; margin: 18px 0; }

    /* Quiz */
    .quizBox { margin-top: 10px; border: 1px solid #e9e9e9; border-radius: 12px; padding: 14px; }
    .quizQ { font-size: 24px; font-weight: 800; margin: 6px 0 10px; text-align:center; }
    .quizChoices { display:grid; grid-template-columns: 1fr; gap: 10px; margin-top: 10px; }
    .choice { background:#f3f3f3; border:1px solid #e2e2e2; font-weight:700; text-align:left; }
    .choice.correct { background:#e7f7ea; border-color:#bfe6c7; }
    .choice.wrong { background:#fde7ea; border-color:#f3b8c1; }
    .quizMeta { margin-top: 10px; display:flex; gap:12px; flex-wrap:wrap; justify-content:space-between; font-size: 15px; color:#333; }
    .small { font-size: 14px; color:#666; }
    @media (max-width: 720px){
      h1 { font-size: 40px; }
      .grid2 { grid-template-columns: 1fr; }
      .card { font-size: 28px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>WordApp</h1>

    <input id="en" type="text" placeholder="English" autocomplete="off" />
    <div style="height:12px"></div>
    <input id="tr" type="text" placeholder="Türkçe" autocomplete="off" />

    <div class="grid2">
      <button class="btn primary" onclick="addWord()">Kelime Ekle</button>
      <button class="btn primary" onclick="randomWord()">Kelime Çalış (Rastgele)</button>
      <button class="btn" onclick="showAnswer()">Cevabı Göster</button>
      <button class="btn danger" onclick="deleteCurrent()">Bu Kelimeyi Sil</button>
    </div>

    <div class="card" id="card">Henüz soru yok</div>

    <div class="meta">
      <div>Toplam kelime: <b id="count">0</b></div>
      <div id="status" class="ok">✅ Hazır. Kelime ekleyebilirsin.</div>
    </div>

    <hr/>

    <div class="grid2">
      <button class="btn" onclick="makeBackup()">Yedek Al (JSON)</button>
      <button class="btn" onclick="copyBackup()">JSON Kopyala</button>
      <button class="btn" onclick="importBackup()">JSON İçe Aktar</button>
    </div>

    <div style="height:12px"></div>
    <textarea id="backupArea" placeholder="Yedek JSON burada görünecek / buraya yapıştırıp İçe Aktar'a basabilirsin"></textarea>

    <div class="small" style="margin-top:10px; line-height:1.5;">
      • Kelimeler cihazında kalıcı kaydedilir (localStorage).<br/>
      • Yedek almak için “Yedek Al (JSON)” → JSON’u kopyalayıp Notlar’a/Drive’a kaydedebilirsin.<br/>
      • Geri yüklemek için JSON’u buraya yapıştır → “JSON İçe Aktar”.
    </div>

    <hr/>

    <!-- QUIZ MODÜLÜ -->
    <h2 style="margin: 0 0 10px; font-size:26px;">Çoktan Seçmeli Quiz</h2>

    <div class="grid2">
      <button class="btn primary" onclick="quizStart()">Quiz Başlat</button>
      <button class="btn" onclick="quizNext()">Sonraki Soru</button>
    </div>

    <div class="quizBox">
      <div class="quizQ" id="quizQuestion">Quiz henüz başlamadı</div>
      <div class="quizChoices" id="quizChoices"></div>

      <div class="quizMeta">
        <div>Skor: <b id="quizScore">0</b> / <b id="quizTotal">0</b></div>
        <div id="quizStatus" class="small">En az 4 kelime ekleyince quiz daha iyi çalışır.</div>
      </div>
    </div>

  </div>

<script>
  // ---------- STORAGE ----------
  const STORAGE_KEY = "wordapp_words_v1";
  let words = [];
  let current = null;       // {en,tr}
  let showingAnswer = false;

  function load() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      words = raw ? JSON.parse(raw) : [];
      if (!Array.isArray(words)) words = [];
    } catch {
      words = [];
    }
    updateInfo("✅ Hazır. Kelime ekleyebilirsin.", true);
    updateCount();
  }

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
    updateCount();
  }

  function updateCount() {
    document.getElementById("count").innerText = String(words.length);
  }

  function updateInfo(msg, ok=true) {
    const el = document.getElementById("status");
    el.className = ok ? "ok" : "bad";
    el.innerText = msg;
  }

  function normalize(s) {
    return (s || "").trim();
  }

  // ---------- MAIN FEATURES ----------
  function addWord() {
    const en = normalize(document.getElementById("en").value);
    const tr = normalize(document.getElementById("tr").value);

    if (!en || !tr) {
      updateInfo("❌ İngilizce ve Türkçe alanlarını doldur.", false);
      return;
    }

    // duplicates: same EN+TR
    const exists = words.some(w => (w.en || "").toLowerCase() === en.toLowerCase() && (w.tr || "").toLowerCase() === tr.toLowerCase());
    if (exists) {
      updateInfo("⚠️ Bu kelime zaten ekli.", false);
      return;
    }

    words.push({ en, tr });
    save();

    document.getElementById("en").value = "";
    document.getElementById("tr").value = "";
    updateInfo("✅ Kelime eklendi.", true);
  }

  function randomWord() {
    if (words.length === 0) {
      updateInfo("❌ Henüz kelime yok. Önce kelime ekle.", false);
      document.getElementById("card").innerText = "Henüz soru yok";
      current = null;
      return;
    }
    const idx = Math.floor(Math.random() * words.length);
    current = words[idx];
    showingAnswer = false;
    document.getElementById("card").innerText = current.en;
    updateInfo("✅ Soru geldi. İstersen cevabı göster.", true);
  }

  function showAnswer() {
    if (!current) {
      updateInfo("❌ Önce “Kelime Çalış (Rastgele)” ile soru getir.", false);
      return;
    }
    document.getElementById("card").innerText = current.tr;
    showingAnswer = true;
    updateInfo("✅ Cevap gösterildi.", true);
  }

  function deleteCurrent() {
    if (!current) {
      updateInfo("❌ Silmek için önce bir kelime getir.", false);
      return;
    }
    const before = words.length;
    words = words.filter(w => !(w.en === current.en && w.tr === current.tr));
    const after = words.length;
    save();
    current = null;
    showingAnswer = false;
    document.getElementById("card").innerText = "Henüz soru yok";
    updateInfo(after < before ? "✅ Kelime silindi." : "⚠️ Kelime bulunamadı.", after < before);
  }

  // ---------- BACKUP ----------
  function makeBackup() {
    document.getElementById("backupArea").value = JSON.stringify(words, null, 2);
    updateInfo("✅ JSON yedek hazır. İstersen kopyalayabilirsin.", true);
  }

  async function copyBackup() {
    const txt = document.getElementById("backupArea").value.trim();
    if (!txt) {
      updateInfo("❌ Önce “Yedek Al (JSON)” ile JSON oluştur.", false);
      return;
    }
    try {
      await navigator.clipboard.writeText(txt);
      updateInfo("✅ JSON kopyalandı.", true);
    } catch {
      // Fallback: select
      const ta = document.getElementById("backupArea");
      ta.focus();
      ta.select();
      updateInfo("⚠️ Otomatik kopyalanamadı. Seçildi—Kopyala yap.", false);
    }
  }

  function importBackup() {
    const txt = document.getElementById("backupArea").value.trim();
    if (!txt) {
      updateInfo("❌ JSON alanı boş.", false);
      return;
    }
    try {
      const arr = JSON.parse(txt);
      if (!Array.isArray(arr)) throw new Error("not array");
      // sanitize
      const cleaned = arr
        .filter(x => x && typeof x.en === "string" && typeof x.tr === "string")
        .map(x => ({ en: normalize(x.en), tr: normalize(x.tr) }))
        .filter(x => x.en && x.tr);

      words = cleaned;
      save();
      updateInfo("✅ JSON içe aktarıldı.", true);
      // Quiz varsa reset
      quizReset();
    } catch {
      updateInfo("❌ JSON geçersiz. Formatı kontrol et.", false);
    }
  }

  // ---------- QUIZ ----------
  let quizActive = false;
  let quizCurrent = null; // {word, options[], correctIndex}
  let quizScore = 0;
  let quizTotal = 0;
  let quizAnswered = false;

  function quizReset() {
    quizActive = false;
    quizCurrent = null;
    quizScore = 0;
    quizTotal = 0;
    quizAnswered = false;
    document.getElementById("quizScore").innerText = "0";
    document.getElementById("quizTotal").innerText = "0";
    document.getElementById("quizQuestion").innerText = "Quiz henüz başlamadı";
    document.getElementById("quizChoices").innerHTML = "";
    document.getElementById("quizStatus").innerText = "En az 4 kelime ekleyince quiz daha iyi çalışır.";
  }

  function quizStart() {
    if (words.length < 4) {
      document.getElementById("quizStatus").innerText = "❌ Quiz için en az 4 kelime lazım (4 şık üretiyoruz).";
      return;
    }
    quizActive = true;
    quizScore = 0;
    quizTotal = 0;
    document.getElementById("quizScore").innerText = "0";
    document.getElementById("quizTotal").innerText = "0";
    document.getElementById("quizStatus").innerText = "✅ Quiz başladı. Şıklardan birini seç.";
    quizNext();
  }

  function quizNext() {
    if (!quizActive) {
      document.getElementById("quizStatus").innerText = "Önce “Quiz Başlat”a bas.";
      return;
    }
    if (words.length < 4) {
      document.getElementById("quizStatus").innerText = "❌ Quiz için en az 4 kelime lazım.";
      return;
    }

    quizAnswered = false;

    // pick correct word
    const correct = words[Math.floor(Math.random() * words.length)];
    // pick 3 wrong translations (unique)
    const wrongPool = words.filter(w => !(w.en === correct.en && w.tr === correct.tr));
    shuffle(wrongPool);

    const options = [correct.tr];
    for (let i = 0; i < wrongPool.length && options.length < 4; i++) {
      const tr = wrongPool[i].tr;
      if (!options.includes(tr)) options.push(tr);
    }

    // If translations collide too much, fallback to any unique
    if (options.length < 4) {
      const allTr = [...new Set(words.map(w => w.tr))].filter(tr => tr !== correct.tr);
      shuffle(allTr);
      for (const tr of allTr) {
        if (options.length >= 4) break;
        if (!options.includes(tr)) options.push(tr);
      }
    }

    if (options.length < 4) {
      document.getElementById("quizStatus").innerText =
        "⚠️ Türkçe karşılıklar çok tekrar ediyor. Daha fazla kelime ekleyince 4 şık daha sağlam olur.";
    } else {
      document.getElementById("quizStatus").innerText = "Şıklardan birini seç.";
    }

    // shuffle options
    shuffle(options);
    const correctIndex = options.indexOf(correct.tr);

    quizCurrent = { word: correct, options, correctIndex };

    // render
    document.getElementById("quizQuestion").innerText = `“${correct.en}” ne demek?`;
    renderChoices();
  }

  function renderChoices() {
    const box = document.getElementById("quizChoices");
    box.innerHTML = "";
    quizCurrent.options.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "choice";
      btn.innerText = opt;
      btn.onclick = () => quizAnswer(idx, btn);
      box.appendChild(btn);
    });
  }

  function quizAnswer(idx, btnEl) {
    if (!quizActive || !quizCurrent || quizAnswered) return;
    quizAnswered = true;
    quizTotal += 1;
    document.getElementById("quizTotal").innerText = String(quizTotal);

    const buttons = [...document.querySelectorAll("#quizChoices .choice")];
    const correctIdx = quizCurrent.correctIndex;

    // mark
    buttons.forEach((b, i) => {
      b.disabled = true;
      if (i === correctIdx) b.classList.add("correct");
    });

    if (idx === correctIdx) {
      quizScore += 1;
      document.getElementById("quizScore").innerText = String(quizScore);
      document.getElementById("quizStatus").innerText = "✅ Doğru! Sonraki soru için “Sonraki Soru”.";
    } else {
      btnEl.classList.add("wrong");
      document.getElementById("quizStatus").innerText =
        `❌ Yanlış. Doğru cevap: “${quizCurrent.options[correctIdx]}”. Sonraki soru için “Sonraki Soru”.`;
    }
  }

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // init
  load();
  quizReset();
</script>
</body>
</html>
